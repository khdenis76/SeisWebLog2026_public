<div class="modal fade" id="dsrExportSmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content">

      <!-- Header (colorful) -->
      <div class="modal-header sm-modal-header">
        <div class="w-100">
          <div class="d-flex align-items-center justify-content-between">
            <h5 class="modal-title mb-0">
              <i class="fas fa-file-export me-2"></i>Export DSR to SM (CSV)
            </h5>
            <span class="sm-chip">
              <i class="fas fa-bolt"></i> Survey Manager
            </span>
          </div>
          <small class="opacity-75 d-block mt-1">
            Choose time range, node status, format, and ROV list. Export returns your CSV.
          </small>
        </div>

        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">

        <!-- MODE -->
        <div class="sm-section">
          <div class="sm-section-head">
            <span class="sm-badge"><span class="sm-dot"></span>Time selection</span>
          </div>
          <div class="sm-section-body">
            <div class="row g-3 align-items-start">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Export mode</label>
                <select class="form-select" id="sm-export-mode">
                  <option value="day" selected>Day</option>
                  <option value="interval">Time interval</option>
                </select>
              </div>

              <div class="col-md-4" id="sm-day-wrap">
                <label class="form-label fw-semibold">Day</label>
                <input type="date" class="form-control" id="sm-day">
              </div>

              <div class="col-md-4 d-none" id="sm-interval-wrap">
                <label class="form-label fw-semibold">From (UTC)</label>
                <input type="datetime-local" class="form-control" id="sm-from">
                <div class="mt-2">
                  <label class="form-label fw-semibold">To (UTC)</label>
                  <input type="datetime-local" class="form-control" id="sm-to">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STATUS + DEPTH -->
        <div class="sm-section">
          <div class="sm-section-head">
            <span class="sm-badge">
              <span class="sm-dot" style="background:linear-gradient(135deg,#ffc107,#fd7e14); box-shadow:0 0 0 4px rgba(255,193,7,.18);"></span>
              Nodes & depth
            </span>
          </div>
          <div class="sm-section-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Nodes</label>
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="sm-status"
                           id="sm-status-deployed" value="deployed" checked>
                    <label class="form-check-label" for="sm-status-deployed">Deployed</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="sm-status"
                           id="sm-status-recovered" value="recovered">
                    <label class="form-check-label" for="sm-status-recovered">Recovered</label>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Depth sign</label>
                <select class="form-select" id="sm-depth-mode">
                  <option value="neg" selected>Negative depth (Z = -abs(depth))</option>
                  <option value="abs">Absolute depth (Z = abs(depth))</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- FORMAT -->
        <div class="sm-section">
          <div class="sm-section-head">
            <span class="sm-badge">
              <span class="sm-dot" style="background:linear-gradient(135deg,#0dcaf0,#0d6efd); box-shadow:0 0 0 4px rgba(13,202,240,.18);"></span>
              Output format
            </span>
          </div>
          <div class="sm-section-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">SM output format</label>
                <select class="form-select" id="sm-format">
                  <option value="z_nodes" selected>Z-nodes</option>
                  <option value="mass_nodes">Mass nodes</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">File name (optional)</label>
                <input class="form-control" id="sm-filename" placeholder="auto-generated if empty">
              </div>
            </div>
          </div>
        </div>

        <!-- ROV LIST -->
        <div class="sm-section">
          <div class="sm-section-head">
            <div class="d-flex align-items-center justify-content-between">
              <span class="sm-badge">
                <span class="sm-dot" style="background:linear-gradient(135deg,#dc3545,#6610f2); box-shadow:0 0 0 4px rgba(220,53,69,.14);"></span>
                ROVs (ROV + ROV1 combined)
              </span>

              <div class="form-check m-0">
                <input class="form-check-input" type="checkbox" id="sm-rov-select-all">
                <label class="form-check-label fw-semibold" for="sm-rov-select-all">Select all</label>
              </div>
            </div>
          </div>

          <div class="sm-section-body">
            <div class="sm-rov-box rounded p-2" style="max-height: 220px; overflow:auto;">
              <div id="sm-rov-list" class="row g-2"></div>
            </div>

            <div class="text-muted small mt-2" id="sm-export-help"></div>
            <div class="alert alert-danger d-none mt-3" id="sm-export-error"></div>
          </div>
        </div>

      </div>

      <!-- Footer -->
      <div class="modal-footer sm-modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-sm-close" data-bs-dismiss="modal">
          Close
        </button>

        <button type="button"
                class="btn btn-sm-export"
                id="sm2file-export-btn"
                data-export-url="{% url 'dsr_export_sm' %}">
          <i class="fas fa-download me-2"></i>Export CSV
        </button>
      </div>

    </div>
  </div>
</div>
